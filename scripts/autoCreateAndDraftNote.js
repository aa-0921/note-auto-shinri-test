// autoCreateAndDraftNote.js
// 薄いラッパー：既存のCLI引数・動作は維持しつつ、実装は共有ライブラリに委譲

import { runWithCore } from '@aa-0921/note-auto-core';

(async () => {
  await runWithCore(async ({ core, wantsBackground }) => {
    // アカウント固有の題材・切り口（ここで管理）
    const topics = [
      '恋愛タイプ診断',
      '第一印象でわかる性格診断',
      '直感力テスト',
      'コミュ力診断',
      'メンタル回復力（レジリエンス）診断',
      '自己肯定感セルフチェック',
      '嫉妬心の扱い方診断',
      'ストレス耐性テスト',
      '対人距離の取り方診断',
      '依存傾向セルフチェック',
      'HSP傾向のセルフ診断',
      '感情コントロール力診断',
      '衝動性セルフチェック',
      '職場コミュニケーション診断',
      '恋の駆け引きスキル診断',
      '思考のクセ（認知）チェック',
      '習慣化タイプ診断',
      'マインドフルネス適性テスト',
      '断れない度チェック',
      '安心感の源泉診断',
    ];

    const patterns = [
      '4択診断（A/B/C/Dを選ぶ）',
      // '直感で選ぶ二択→分岐して4タイプに',
      '色でわかる4タイプ診断',
      '動物でわかる4タイプ診断',
      '食べ物の好みでわかる4タイプ診断',
      '第一印象で選ぶ4つのシーン診断',
      '休日の過ごし方でわかる4タイプ診断',
      'メッセージの返信でわかる4タイプ診断',
      '行動の優先度でわかる4タイプ診断',
      '理想のデートでわかる4タイプ診断',
    ];

    const rewriteConditionsLines = [
      'あなたは男性の心理カウンセラーです。',
      '心理学・脳科学・行動科学の専門知識を活用し、科学的根拠に基づいた説得力のある解説を提供してください。',
      'やさしい口調（です・ます）で、心理テストの問題文や解説を自然に厚く整えてください。',
      '【注意】',
      '- タイトルや見出しは出力せず、本文のみを返す。',
      '- メタ情報（追加要素や文字数など）は一切出力しない。',
      '- 絵文字を各行に1つ程度。',
      '- noteのMarkdownのみ使用。',
      '- 箇条書きは「・ 」、番号付きリストは使わない。',
      '- 問題文と答え・解説の間に長めの空行を挿入してワクワク感を演出。',
      '- 解説では心理学的根拠や脳科学の知見を含めて、読者が「なるほど」と納得できる内容にしてください。',
      '- 専門用語は使わず、「心理学では」「脳科学では」といった表現で分かりやすく説明してください。',
      '- アドバイスは実践的で具体的な行動指針を含めてください。',
    ];

    // LLM用システムプロンプト（参考実装に準拠）
    const systemMessage = 'あなたは日本語のnote向け心理テスト作成者で、男性の心理カウンセラーです。心理学・脳科学・行動科学の知識を活用し、科学的根拠に基づいた説得力のある解説と実践的なアドバイスを提供します。やさしい口調で読者が楽しく回答でき、かつ「なるほど」と納得できる高品質なコンテンツを作ります。';

    // 記事生成プロンプト条件（参考実装の「promptLines」相当）
    const articleConditionsLines = [
      'タイトル、本文、ハッシュタグ（#から始まるもの）を含めてください。',
      'タイトルは1行目に「# [実際のタイトル]」として記載してください。',
      '「# タイトル」という文字列ではなく、実際の記事タイトルを入れてください。',
      'タイトルの最後に必ず「【心理テスト】」を付けてください。',
      '本文にはタイトルを含めないでください。',
      '本文は次の簡潔な構成で作成してください。',
      '1) 問題文（1〜2行）',
      '2) 選択肢（A/B/C/Dの4択、各1行）',
      '選択肢の直前に、次のガイド文を1行で必ず表示してください：「深呼吸して、A〜Dの中から心のままにひとつ選んでください✨」',
      '問題文には必ず「あなたが自分自身に似ていると思う動物はどれですか？」のような明確な選択基準を含めてください。',
      '3) 結果セクション（A/B/C/Dごとに「結果・解説・アドバイス」を必ず含める）',
      '各タイプの「解説」と「アドバイス」は、それぞれ200文字程度、最低5文で具体的に書いてください。',
      '「解説」には心理学的な根拠や研究結果を織り交ぜて、読者が「なるほど」と納得できる内容にしてください。',
      '解説では以下の要素を含めてください：',
      '・性格心理学や行動心理学の観点からの説明',
      '・脳科学や神経科学の知見（例：前頭前野の働き、ドーパミン分泌など）',
      '・認知バイアスや思考パターンの説明',
      '・人間関係やコミュニケーションにおける特徴',
      '専門用語（デフォルトモード・ネットワーク、前頭前野、ドーパミンなど）は使わず、',
      '「心理学では」「脳科学では」「神経科学では」といった表現で分かりやすく説明してください。',
      '「アドバイス」は実践的で具体的な行動指針を含め、読者の日常に活かせる内容にしてください。',
      'アドバイスでは以下の要素を含めてください：',
      '・具体的な行動改善方法（例：「朝の10分間の瞑想を習慣にする」）',
      '・人間関係の改善策（例：「相手の話を最後まで聞いてから意見を述べる」）',
      '・ストレス対処法やメンタルケアの方法',
      '・長期的な成長につながる習慣の提案',
      '問題文と「結果」セクションの間に2〜3行の空行を入れてワクワク感を演出してください。',
      '結果セクションでは各タイプの境界を明確にするため、各タイプの冒頭に「―――― A ――――」のような区切り線を入れてください（B/C/Dも同様）。',
      '「解説」「アドバイス」で箇条書きを使用する場合は、各項目を改行して見やすくしてください。',
      '各タイプの書式は厳守（1行1項目・改行で区切る／ラベルは太字）：',
      '―――――――― A ――――――――',
      '**結果**：...',
      '**解説**：...',
      '**アドバイス**：...',
      '―――――――― B ――――――――',
      '**結果**：...',
      '**解説**：...',
      '**アドバイス**：...',
      '―――――――― C ――――――――',
      '**結果**：...',
      '**解説**：...',
      '**アドバイス**：...',
      '―――――――― D ――――――――',
      '**結果**：...',
      '**解説**：...',
      '**アドバイス**：...',
      '絵文字は落ち着いたものを各行に1つ程度（例：🌙 🍃 ✨ 🕊️）。',
      'すべて日本語で出力してください。',
      'noteの正しいマークダウン記法のみを使ってください。',
      '箇条書きはマークダウンではなく、「・ 」で表現してください。',
      '見出しはh2（## 見出し）・h3（### 見出し）のみ。',
      '見出しに「**」等は使わないでください。',
      '番号付きリストは使わないでください。',
      'h1（# タイトル）はタイトル行のみで本文中では使わないでください。',
      'その他のマークダウンやHTMLタグは使わないでください。',
    ];

    // タグ生成の指示文（参考実装：固定タグの必須含有を要求）
    const tagsInstruction =
      '記事内容から最も関連する日本語タグを3〜5個生成し、半角スペース区切りで出力してください。必ず「#心理テスト #診断 #性格診断 #PR」を含めてください。本文や説明は禁止。';

    // タイトル装飾用絵文字（参考実装のセット）
    const titleEmojis = [
      '🌙',
      '🌕',
      '🌜',
      '⭐',
    ];

    // 記事内に挿入するアフィリエイト文（複数バリエーション）
    const affiliateLinks = [
      [
        '',
        '🌙　🍵　🌿　🍵　🌙　🍵　🌿　🍵　🌙',
        'https://amzn.to/3VxZ0FG',
        '心を落ち着かせて、健康にも良いあずき茶をおすすめします。',
        'ゆったり過ごしたい夜に、静かに寄り添う一杯をどうぞ。🍃',
        '香りは濃く香ばしく、癖がなく飲みやすいです。',
        '甘い香りとやさしい甘みで、毎日でも続けやすい味わいです。🍵',
        '活性酸素を抑える働きが期待でき、からだ想いの一杯です。✨',
        '🌙　🍵　🌿　🍵　🌙　🍵　🌿　🍵　🌙',
        '',
      ].join('\n'),

      // ----一旦note-auto-renaiと同じものを使用-----------
      // ----↓できれば個々の商品でアフィリエイトリンクも個々のものにしたい-----------
      [
        '',
        '📖　✨　📖　✨　📖　✨　📖　✨　📖',
        'https://amzn.to/4goaSUk',
        '最近話題の引き寄せの法則😊結構面白いのでおすすめです😊',
        '📖　✨　📖　✨　📖　✨　📖　✨　📖',
        '',
      ].join('\n'),

      [
        '',
        '💧　✨　💧　✨　💧　✨　💧　✨　💧',
        'https://amzn.to/3WcMnzT',
        '1本あたり約50円とかなり安いので、この機会に水分補給を日課にしてはどうでしょうか😊',
        '💧　✨　💧　✨　💧　✨　💧　✨　💧',
        '',
      ].join('\n'),

      [
        '',
        '🥤　✨　🥤　✨　🥤　✨　🥤　✨　🥤',
        'https://amzn.to/46DCvEs',
        '👆炭酸は血行促進で疲労回復や美肌づくりをサポートする効果があります⭕',
        '胃を刺激して満腹感を与え、腸の働きを活発にしてダイエットや便秘解消にも役立ちます👌',
        '🥤　✨　🥤　✨　🥤　✨　🥤　✨　🥤',
        '',
      ].join('\n'),

      [
        '',
        '🍅　✨　🍅　✨　🍅　✨　🍅　✨　🍅',
        'https://amzn.to/4pAZwAB',
        '👆トマトジュースにはリコピンなど豊富な栄養素が含まれています🎉',
        '生活習慣病予防や美肌、むくみ改善、ダイエットサポートに役立ち、手軽に栄養補給できます！！💪',
        '🍅　✨　🍅　✨　🍅　✨　🍅　✨　🍅',
        '',
      ].join('\n'),

      [
        '',
        '🍵　✨　🍵　✨　🍵　✨　🍵　✨　🍵',
        'https://amzn.to/4nOiNN9',
        '👆濃い緑茶には茶カテキンが豊富で、体脂肪減少や血糖値上昇抑制、動脈硬化や認知症予防など多くの健康効果が期待できます㊙️',
        '🍵テアニンによるリラックス作用もあり、心身のバランスを整える飲み物です🍵',
        '🍵　✨　🍵　✨　🍵　✨　🍵　✨　🍵',
        '',
      ].join('\n'),

      [
        '',
        '🍫　✨　🍫　✨　🍫　✨　🍫　✨　🍫',
        'https://amzn.to/48uTL0X',
        '👆プロテインバーは筋肉維持・増強やダイエットサポート、美容や免疫力向上などに役立ち、効率的にタンパク質を補給できるのが魅力です💪',
        'コンビニより安く、忙しい時でもスピーディーに栄養補給ができ、健康維持や体づくりをサポートします🌸',
        '🍫　✨　🍫　✨　🍫　✨　🍫　✨　🍫',
        '',
      ].join('\n'),

      [
        '',
        '🍚　✨　🍚　✨　🍚　✨　🍚　✨　🍚',
        'https://amzn.to/42KiV8b',
        '👆発芽米は玄米よりビタミン・ミネラル・食物繊維が豊富で、GABAによるストレス緩和や血圧降下作用など健康効果が期待できます🍚',
        '🍚お米の値段も上がっている今、どうせなら体に優しい発芽米を選んで美味しく健康に💊',
        '🍚　✨　🍚　✨　🍚　✨　🍚　✨　🍚',
        '',
      ].join('\n')
    ];

    // マガジン誘導文（参考実装の体裁を反映）
    const magazinePromotion = [];
    
    // const magazinePromotion = [
    //   '🐈　🐾　🐈‍⬛　🐾　🐈　🐾　🐈‍⬛　🐾　🐈　🐾　🐈‍⬛　🐾　🐈　🐾　🐈‍⬛　',
    //   '',
    //   '✅「物理的に幸せになるおすすめグッズ達」',
    //   '',
    //   '私が皆さんにおすすめしているコスパ抜群のグッズをご紹介しています！',
    //   '効果テキメンなので皆さん試してみていただけると幸いです😊',
    //   '',
    //   '【コスパ抜群の幸せグッズ】',
    //   '✔ 効果テキメンのアイテム',
    //   '✔ 実際に使って良かったもの',
    //   'そんなグッズを厳選してご紹介。',
    //   '',
    //   'ぜひ試してみてください！',
    //   '',
    //   'https://note.com/counselor_risa/m/m72a580a7e712',
    //   '',
    //   '🐈　🐾　🐈‍⬛　🐾　🐈　🐾　🐈‍⬛　🐾　🐈　🐾　🐈‍⬛　🐾　🐈　🐾　🐈‍⬛　',
    //   '',
    // ].join('\n');

    // アソシエイト表記文（参考実装の文言）
    const amazonAssociateText =
      'Amazon のアソシエイトとして、「🌙こころ診断ラボ💕心理テスト💕」は適格販売により収入を得ています。';

    // 記事の自動生成と下書き保存機能を実行
    await core.runAutoCreateAndDraftNote({
      background: wantsBackground,
      topics,
      patterns,
      systemMessage,
      articleConditionsLines,
      rewriteConditionsLines,
      tagsInstruction,
      titleEmojis,
      // affiliateLink
      affiliateLinks,
      magazinePromotion,
      amazonAssociateText,
    });
    console.log('記事の自動生成と下書き保存が完了しました');
  });
})();
