// autoCreateAndDraftNote.js
// 薄いラッパー：既存のCLI引数・動作は維持しつつ、実装は共有ライブラリに委譲

import { runWithCore } from '@aa-0921/note-auto-core';

// アフィリエイト設定とリンクを別ファイルから読み込み
import { affiliateConfig, affiliateLinks } from './affiliateConfig.js';

// 再エクスポート（他のファイルから参照できるように）
export { affiliateConfig, affiliateLinks };

(async () => {
  await runWithCore(async ({ core, wantsBackground }) => {
    // アカウント固有の題材・切り口（ここで管理）
    const topics = [
      '恋愛タイプ診断',
      '第一印象でわかる性格診断',
      '直感力テスト',
      'コミュ力診断',
      'メンタル回復力（レジリエンス）診断',
      '自己肯定感セルフチェック',
      '嫉妬心の扱い方診断',
      'ストレス耐性テスト',
      '対人距離の取り方診断',
      '依存傾向セルフチェック',
      'HSP傾向のセルフ診断',
      '感情コントロール力診断',
      '衝動性セルフチェック',
      '職場コミュニケーション診断',
      '恋の駆け引きスキル診断',
      '思考のクセ（認知）チェック',
      '習慣化タイプ診断',
      'マインドフルネス適性テスト',
      '断れない度チェック',
      '安心感の源泉診断',
      'リーダーシップ診断',
      '創造性診断',
      '共感力診断',
      '決断力診断',
      '集中力診断',
      '記憶力診断',
      '学習スタイル診断',
      '時間管理能力診断',
      '問題解決力診断',
      'コミュニケーションスタイル診断',
      'ストレス対処法診断',
      'モチベーション維持力診断',
      'チームワーク適性診断',
      'プレゼンテーション能力診断',
      '交渉力診断',
      'マネジメント適性診断',
      'イノベーション思考診断',
      'リスク管理能力診断',
      '変化適応力診断',
      '継続力診断',
      '分析力診断',
      '直感力診断',
      '観察力診断',
      '表現力診断',
      '理解力診断',
      '応用力診断',
      '柔軟性診断',
      '忍耐力診断',
      '協調性診断',
      '独立性診断',
      '責任感診断',
      '誠実性診断',
      '開放性診断',
      '外向性診断',
      '神経症傾向診断',
      '勤勉性診断',
      '親和性診断',
    ];

    // 切り口リスト（心理学・心理テスト向けに更新）
    const patterns = [
      // '色でわかる4タイプ診断',
      // '動物でわかる4タイプ診断',
      // '食べ物の好みでわかる4タイプ診断',
      // '第一印象で選ぶ4つのシーン診断',
      // '休日の過ごし方でわかる4タイプ診断',
      // 'メッセージの返信でわかる4タイプ診断',
      // '行動の優先度でわかる4タイプ診断',
      // '理想のデートでわかる4タイプ診断',

      // 2025/11/11ーーーーーーーーーーーーーーーーーーーーー
      '朝のルーティンでわかる4タイプ診断',
      '好きな飲み物でわかる4タイプ診断',
      'SNSの使い方でわかる4タイプ診断',
      '休日の起きる時間でわかる4タイプ診断',
      '部屋の片付け方でわかる4タイプ診断',
      '買い物の決め方でわかる4タイプ診断',
      '映画の見方でわかる4タイプ診断',
      '寝る前の過ごし方でわかる4タイプ診断',
      '朝食の取り方でわかる4タイプ診断',
      '音楽の聴き方でわかる4タイプ診断',
      '読書のスタイルでわかる4タイプ診断',
      'メッセージの既読タイミングでわかる4タイプ診断',
      '予定の立て方でわかる4タイプ診断',
      '仕事・勉強の休憩の取り方でわかる4タイプ診断',
      '初対面での挨拶の仕方でわかる4タイプ診断',
      'オンライン会議での振る舞いでわかる4タイプ診断',
      'プレゼントの選び方でわかる4タイプ診断',
      'カフェでの過ごし方でわかる4タイプ診断',
      '旅行の準備の仕方でわかる4タイプ診断',
      '写真の撮り方でわかる4タイプ診断',
      '歩くスピードでわかる4タイプ診断',
      '財布の使い方でわかる4タイプ診断',
      'スマホ通知の設定でわかる4タイプ診断',
      'イヤホンの使い方でわかる4タイプ診断',
      '朝の服選びでわかる4タイプ診断',
      '雨の日の過ごし方でわかる4タイプ診断',
      '週末の計画の立て方でわかる4タイプ診断',
      '昼休みの過ごし方でわかる4タイプ診断',
      'タスクの締切前の動き方でわかる4タイプ診断',
      '集中力が切れた時の対処でわかる4タイプ診断',
      '返信の文面スタイルでわかる4タイプ診断',
      '写真フォルダの整理方法でわかる4タイプ診断',
      'アラームの使い方でわかる4タイプ診断',
      'ノートの取り方でわかる4タイプ診断',
      '食事を決める基準でわかる4タイプ診断',
      '新しいことの始め方でわかる4タイプ診断',
      'ミスの振り返り方でわかる4タイプ診断',
      '友だちとの約束の決め方でわかる4タイプ診断',
      '人混みでの過ごし方でわかる4タイプ診断',
      '並ぶ列の選び方でわかる4タイプ診断',
      '天気予報の見方でわかる4タイプ診断',
      '地図アプリの使い方でわかる4タイプ診断',
      '家計管理の仕方でわかる4タイプ診断',
      '洗濯物のたたみ方でわかる4タイプ診断',
      'ゲームの遊び方でわかる4タイプ診断',
      'ネガティブな気分の切り替え方でわかる4タイプ診断',
      '初めての店での注文の仕方でわかる4タイプ診断',
    ];

    const rewriteConditionsLines = [
      'あなたは男性の心理カウンセラーです。',
      '心理学・脳科学・行動科学の専門知識を活用し、科学的根拠に基づいた説得力のある解説を提供してください。',
      'やさしい口調（です・ます）で、心理テストの問題文や解説を自然に厚く整えてください。',
      '【注意】',
      '- タイトルや見出しは出力せず、本文のみを返す。',
      '- メタ情報（追加要素や文字数など）は一切出力しない。',
      '- 絵文字を各行に1つ程度。',
      '- noteのMarkdownのみ使用。',
      '- 箇条書きは「・ 」、番号付きリストは使わない。',
      '- 問題文と答え・解説の間に長めの空行を挿入してワクワク感を演出。',
      '- 解説では心理学的根拠や脳科学の知見を含めて、読者が「なるほど」と納得できる内容にしてください。',
      '- 専門用語は使わず、「心理学では」「脳科学では」といった表現で分かりやすく説明してください。',
      '- アドバイスは実践的で具体的な行動指針を含めてください。',
    ];

    // LLM用システムプロンプト（参考実装に準拠）
    const systemMessage = 'あなたは日本語のnote向け心理テスト作成者で、男性の心理カウンセラーです。心理学・脳科学・行動科学の知識を活用し、科学的根拠に基づいた説得力のある解説と実践的なアドバイスを提供します。やさしい口調で読者が楽しく回答でき、かつ「なるほど」と納得できる高品質なコンテンツを作ります。';

    // 記事生成プロンプト条件（参考実装の「promptLines」相当）
    const articleConditionsLines = [
      'タイトル、本文、ハッシュタグ（#から始まるもの）を含めてください。',
      'タイトルは1行目に「# [実際のタイトル] | 心理テスト | 性格診断 | 自己分析 | メンタル | ポジティブ | フォロバ | フォロバ100 」として記載してください。',
      '「# タイトル」という文字列ではなく、実際の記事タイトルを入れてください。',
      'タイトルの最後に必ず「【心理テスト】」を付けてください。',
      '本文にはタイトルを含めないでください。',
      '本文は次の簡潔な構成で作成してください。',
      '1) 問題文（1〜2行）',
      '2) 関連する科学的解説セクション（2〜3行の解説文）',
      '選択肢の直前に、記事タイトルや心理テスト内容に関連する豆知識を必ず挿入してください。',
        '解説は記事のテーマに応じて適切な内容を含めてください（下記は例）：',
        '・感情コントロール関連：「感情をコントロールする脳の働き」「ストレスへの反応の仕組み」「気持ちを落ち着ける方法」',
        '・第一印象関連：「一瞬での判断の速さ」「視覚的な記憶の特徴」「無意識に作られる先入観」',
        '・直感力関連：「直感の判断力の精度」「潜在的な意識の働き」「思い出や経験による自動的な判断」',
        '・コミュニケーション関連：「人との距離感」「言葉や表情でのコミュニケーション」「社会での認識の仕組み」',
        '・その他：記事テーマに合った心理学的・脳科学的な豆知識',
        '【重要】専門用語（前頭前野、扁桃体、デフォルトモードネットワークなど）は使用せず、',
        '「脳科学の研究結果では」「心理学では」「研究によると」といった表現で分かりやすく説明してください。',
      '3) 選択肢（A/B/C/Dの4択、各1行）',
      '選択肢の直前に、次のガイド文を1行で必ず表示してください：「深呼吸して、A〜Dの中から心のままにひとつ選んでください✨」',
      '問題文には、記事タイトルに対応した明確な選択基準を含めてください（例：「あなたが最初に目に入った景色はどれですか？」「あなたが自分に似ていると思う動物はどれですか？」など）。',
      '4) 結果セクション（A/B/C/Dごとに「結果・解説・アドバイス」を必ず含める）',
      '【重要】必ず4つすべて（A、B、C、D）のタイプの結果・解説・アドバイスを完成させてください。途中で終わらせないでください。',
      '各タイプの「解説」と「アドバイス」は、それぞれ200文字程度、最低5文で具体的に書いてください。',
      '「解説」には心理学的な根拠や研究結果を織り交ぜて、読者が「なるほど」と納得できる内容にしてください。',
      '解説では以下の要素を含めてください：',
      '・性格心理学や行動心理学の観点からの説明',
      '・脳科学や神経科学の知見（例：「感情をコントロールする脳の働き」「気分を良くする脳内物質の分泌」など）',
      '・認知バイアスや思考パターンの説明',
      '・人間関係やコミュニケーションにおける特徴',
      '【重要】専門用語（デフォルトモード・ネットワーク、前頭前野、ドーパミン、扁桃体など）は使わず、',
      '「心理学では」「脳科学では」「研究によると」といった表現で分かりやすく説明してください。',
      '「アドバイス」は実践的で具体的な行動指針を含め、読者の日常に活かせる内容にしてください。',
      'アドバイスでは以下の要素を含めてください：',
      '・具体的な行動改善方法（例：「朝の10分間の瞑想を習慣にする」）',
      '・人間関係の改善策（例：「相手の話を最後まで聞いてから意見を述べる」）',
      '・ストレス対処法やメンタルケアの方法',
      '・長期的な成長につながる習慣の提案',
      '問題文と「結果」セクションの間に2〜3行の空行を入れてワクワク感を演出してください。',
      '結果セクションでは各タイプの境界を明確にするため、各タイプの冒頭に「―――― A ――――」のような区切り線を入れてください（B/C/Dも同様）。',
      '「解説」「アドバイス」で箇条書きを使用する場合は、各項目を改行して見やすくしてください。',
      '各タイプの書式は厳守（1行1項目・改行で区切る／ラベルは太字）：',
      '―――――――― A ――――――――',
      '**結果**：...',
      '**解説**：...',
      '**アドバイス**：...',
      '―――――――― B ――――――――',
      '**結果**：...',
      '**解説**：...',
      '**アドバイス**：...',
      '―――――――― C ――――――――',
      '**結果**：...',
      '**解説**：...',
      '**アドバイス**：...',
      '―――――――― D ――――――――',
      '**結果**：...',
      '**解説**：...',
      '**アドバイス**：...',
      '【最重要】上記のA、B、C、Dの4つすべてのタイプを必ず完成させて出力してください。Dまで必ず含めてください。',
      '絵文字は落ち着いたものを各行に1つ程度（例：🌙 🍃 ✨ 🕊️）。',
      'すべて日本語で出力してください。',
      'noteの正しいマークダウン記法のみを使ってください。',
      '箇条書きはマークダウンではなく、「・ 」で表現してください。',
      '見出しはh2（## 見出し）・h3（### 見出し）のみ。',
      '見出しに「**」等は使わないでください。',
      '番号付きリストは使わないでください。',
      'h1（# タイトル）はタイトル行のみで本文中では使わないでください。',
      'その他のマークダウンやHTMLタグは使わないでください。',
      '【最終確認】A、B、C、Dの4つすべてのタイプの結果・解説・アドバイスを必ず完成させて出力してください。',
    ];

    // タグ生成の指示文（参考実装：固定タグの必須含有を要求）
    const tagsInstruction =
      '記事内容から最も関連する日本語タグを3〜5個生成し、半角スペース区切りで出力してください。必ず「#心理テスト #性格診断 #心理学 #自己分析 #PR」を含めてください。本文や説明は禁止。';

    // タイトル装飾用絵文字（参考実装のセット）
    const titleEmojis = [
      '🌙',
      '🌕',
      '🌜',
      '⭐',
    ];


    // マガジン誘導文（参考実装の体裁を反映）
    const magazinePromotion = [];

    // const magazinePromotion = [
    //   '🐈　🐾　🐈‍⬛　🐾　🐈　🐾　🐈‍⬛　🐾　🐈　🐾　🐈‍⬛　🐾　🐈　🐾　🐈‍⬛　',
    //   '',
    //   '✅「物理的に幸せになるおすすめグッズ達」',
    //   '',
    //   '私が皆さんにおすすめしているコスパ抜群のグッズをご紹介しています！',
    //   '効果テキメンなので皆さん試してみていただけると幸いです😊',
    //   '',
    //   '【コスパ抜群の幸せグッズ】',
    //   '✔ 効果テキメンのアイテム',
    //   '✔ 実際に使って良かったもの',
    //   'そんなグッズを厳選してご紹介。',
    //   '',
    //   'ぜひ試してみてください！',
    //   '',
    //   'https://note.com/counselor_risa/m/m72a580a7e712',
    //   '',
    //   '🐈　🐾　🐈‍⬛　🐾　🐈　🐾　🐈‍⬛　🐾　🐈　🐾　🐈‍⬛　🐾　🐈　🐾　🐈‍⬛　',
    //   '',
    // ].join('\n');

    // アソシエイト表記文（参考実装の文言）
    const amazonAssociateText =
      'Amazon のアソシエイトとして、「🌙こころ診断ラボ💕心理テスト💕」は適格販売により収入を得ています。';

    // おすすめ記事セクションの設定
    const recommendedArticlesTitle = 'ぜひ読んでほしい🌙他のおすすめ記事💕';
    const recommendedArticlesUrls = [
      'https://note.com/shinri_test/n/nb9c8550bf8ed',
      'https://note.com/shinri_test/n/nc162c4373b0e',
      'https://note.com/shinri_test/n/nc863ee4c40e8',
      'https://note.com/shinri_test/n/ne41e16cd348a',
    ];

    // 記事の自動生成と下書き保存機能を実行
    await core.runAutoCreateAndDraftNote({
      background: wantsBackground,
      topics,
      patterns,
      systemMessage,
      articleConditionsLines,
      rewriteConditionsLines,
      tagsInstruction,
      titleEmojis,
      affiliateLinks,
      magazinePromotion,
      amazonAssociateText,
      // Audible・Kindleアフィリエイト設定（affiliateConfigから取得）
      affiliateTag: affiliateConfig.affiliateTag,
      audibleAffiliateEnabled: affiliateConfig.audibleAffiliateEnabled,
      kindleAffiliateEnabled: affiliateConfig.kindleAffiliateEnabled,
      // おすすめ記事セクション設定
      recommendedArticlesTitle,
      recommendedArticlesUrls,
    });
    console.log('記事の自動生成と下書き保存が完了しました');
  });
})();
